version: "3"

services:
  web:
    build:
      context: ./web
      dockerfile: Dockerfile.prod
    environment:
      # Set to the port that your webapp listens on
      VIRTUAL_PORT=80
      # Can be comma-separated list
      VIRTUAL_HOST=monitoremulator.com
      # The domain for the cert, can also be comma-separated
      LETSENCRYPT_HOST=monitoremulator.com
      # Your email for the cert
      LETSENCRYPT_EMAIL=tajantonius@gmail.com

  api:
    build:
      context: ./api
      dockerfile: Dockerfile.prod
    environment:
      DB_URL: mongodb://db/monemu
      # Set to the port that your webapp listens on
      VIRTUAL_PORT=80
      # Can be comma-separated list
      VIRTUAL_HOST=monitoremulator.com
      # The domain for the cert, can also be comma-separated
      LETSENCRYPT_HOST=monitoremulator.com
      # Your email for the cert
      LETSENCRYPT_EMAIL=tajantonius@gmail.com

  db:
    image: mongo:4.0-xenial
    volumes:
      - monemu:/data/db

volumes:
  monemu:

networks:
  default:
    external:
      name: letsencrypt

